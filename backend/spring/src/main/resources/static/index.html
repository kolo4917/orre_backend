<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
    <script type="text/javascript">
        var stompClient = null;

        function setConnected(connected) {
            document.getElementById('connect').disabled = connected;
            document.getElementById('disconnect').disabled = !connected;
            document.getElementById('conversationDiv').style.visibility = connected ? 'visible' : 'hidden';
            document.getElementById('response').innerHTML = '';
        }

        function connect() {
            var socket = new SockJS('/ws');
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function (frame) {
                setConnected(true);
                console.log('Connected: ' + frame);
                stompClient.subscribe('/topic/waitingInfo', function (greeting) {
                    showGreeting(greeting.body);;
                });
            });
        }

        function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect();
            }
            setConnected(false);
            console.log("Disconnected");
        }

        function sendWaitingUserInfo() {
            var serverCode = document.getElementById('serverCode').value;
            var myName = document.getElementById('myName').value;
            var phoneNumber = document.getElementById('phoneNumber').value;
            var numberOfUs = document.getElementById('numberOfUs').value;
            stompClient.send("/app/register", {}, JSON.stringify({
                'serverCode': serverCode,
                'myName': myName,
                'phoneNumber': phoneNumber,
                'numberOfUs': numberOfUs
            }));
        }
        function showGreeting(message) {
            // 메시지를 객체로 파싱합니다.
            var messageData = JSON.parse(message);

            var response = document.getElementById('response');
            // 기존 내용을 지우고 새 내용을 추가합니다.
            response.innerHTML = '';

            // 객체의 각 속성을 확인하고, 값이 있으면 표시하고, 없으면 '정보 없음'을 표시합니다.
            var serverCode = messageData.serverCode || '정보 없음';
            var myName = messageData.myName || '정보 없음';
            var phoneNumber = messageData.phoneNumber || '정보 없음';
            var numberOfUs = messageData.numberOfUs || '정보 없음';

            // DOM에 새로운 내용을 추가합니다.
            response.innerHTML += "<p>Server Code: " + serverCode + "</p>";
            response.innerHTML += "<p>My Name: " + myName + "</p>";
            response.innerHTML += "<p>Phone Number: " + phoneNumber + "</p>";
            response.innerHTML += "<p>Number of Us: " + numberOfUs + "</p>";
        }

    </script>
</head>
<body>
<div>
    <button id="connect" onclick="connect();">Connect</button>
    <button id="disconnect" onclick="disconnect();" disabled="disabled">Disconnect</button>
</div>
<div id="conversationDiv" style="visibility: hidden;">
    <label>Server Code:</label><input type="text" id="serverCode" />
    <label>My Name:</label><input type="text" id="myName" />
    <label>Phone Number:</label><input type="text" id="phoneNumber" />
    <label>Number of Us:</label><input type="number" id="numberOfUs" />
    <button onclick="sendWaitingUserInfo();">Send</button>
    <p id="response"></p>
    <button id="checkWaiting" onclick="window.location.href='waiting.html'">waiting</button>
</div>
</body>
</html>
