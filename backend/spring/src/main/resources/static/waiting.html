<!DOCTYPE html>
<html>
<head>
    <title>Waiting Status</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>
</head>
<body>

<h1>Waiting</h1>
<div id="currentWaitingStatus">
    <!-- 여기에 웨이팅 상태를 표시합니다. -->
</div>

<script type="text/javascript">
    var stompClient = null;

    function connect() {
        var socket = new SockJS('/ws');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);
            // 웨이팅 유저 정보 구독
            stompClient.subscribe('/topic/waitingInfo', function (message) {
                updateWaitingUserInfo(JSON.parse(message.body));
            });
            // 웨이팅 테이블 정보 구독
            stompClient.subscribe('/topic/waitingTimeInfo', function (message) {
                updateWaitingTableInfo(JSON.parse(message.body));
            });
            // 웨이팅 유저 정보 요청
            requestWaitingInfo();
            // 웨이팅 테이블 정보 요청
            requestWaitingTableInfo();
        });
    }

    function requestWaitingInfo() {
        stompClient.send("/app/waitingInfoRequest", {}, JSON.stringify({ request: 'waitingInfo' }));
    }

    function requestWaitingTableInfo() {
        stompClient.send("/app/waitingTimeInfoRequest", {}, JSON.stringify({ request: 'waitingTimeInfo' }));
    }

    function updateWaitingUserInfo(waitingInfo) {
        var currentWaitingStatusDiv = document.getElementById('currentWaitingStatus');
        var htmlContent = `
            <p>Server Code: ${waitingInfo.serverCode || '정보 없음'}</p>
            <p>My Name: ${waitingInfo.myName || '정보 없음'}</p>
            <p>Phone Number: ${waitingInfo.phoneNumber || '정보 없음'}</p>
            <p>Number of Us: ${waitingInfo.numberOfUs || '정보 없음'}</p>
        `;
        currentWaitingStatusDiv.innerHTML += htmlContent; // 기존 내용에 추가합니다.
    }

    function updateWaitingTableInfo(waitingTableInfo) {
        var currentWaitingStatusDiv = document.getElementById('currentWaitingStatus');
        var htmlContent = `
            <p>Last Waiting Number: ${waitingTableInfo.lastWaitingNumber || '정보 없음'}</p>
            <p>Predict Waiting Time: ${waitingTableInfo.predictWaitingTime || '정보 없음'} minutes</p>
        `;
        currentWaitingStatusDiv.innerHTML += htmlContent; // 기존 내용에 추가합니다.
    }

    window.onload = connect;
</script>

</body>
</html>
